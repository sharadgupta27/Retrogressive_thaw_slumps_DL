Bootstrap: docker
FROM: ubuntu:20.04
OSVersion: ubuntu:20.04


%help
    Singularity container for running yolov4 (CPU only)
    #created based on https://github.com/AlexeyAB/darknet#requirements

%labels
	Maintainer: Lingcao Huang

%environment
    export LC_ALL=C
    export PATH=/usr/local/darknet:$PATH

#setup

## %post -c /bin/bash : use bash as default intead of sh
%post
    export DEBIAN_FRONTEND=noninteractive
# prep apt-get and cudnn
    apt-get update && apt-get install -y --no-install-recommends \
    apt-utils

# install requirements
    apt-get update \
  	&& apt-get install -y --no-install-recommends \
	    build-essential \
        libopencv-dev \
        cmake \
        libomp-dev  \
        git \
        vim \
	  && apt-get clean \
	  && rm -rf /var/lib/apt/lists/*

# install  darknet
    cd /usr/local && \
    export GIT_SSL_NO_VERIFY=1 && \
    git clone https://github.com/AlexeyAB/darknet
    # go into the folder, change makefile to have OPENCV enabled and others
    cd darknet && \
    sed -i 's/OPENCV=0/OPENCV=1/' Makefile && \
    sed -i 's/OPENMP=0/OPENMP=1/' Makefile && \
    sed -i 's/AVX=0/AVX=1/' Makefile && \
    sed -i 's/LIBSO=0/LIBSO=1/' Makefile && \
    make




